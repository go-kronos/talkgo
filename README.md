# talkgo
TalkGo读书会笔记（TalkGo 读书会第一期：Linux 性能优化实战 by 倪朋飞）

《[项目文档——石墨文档](https://shimo.im/sheets/1lq7MgXnBphdeWAe/MODOC)》

[TalkGo 读书会第一期](https://talkgo.org/t/topic/136)

[Linux性能优化实战——极客专栏](https://time.geekbang.org/column/intro/140)

[启动会slide](https://docs.google.com/presentation/d/16cNCT1aqSsuVA-TPep81NGFlYIM2AO9LPFoZgA1776Y/edit?usp=sharing)

## 目标

### 阶段小结：
0. **每阶段产出一篇不小于200字的总结**
1. 每两周，一句话描述你在本阶段的感受（必须）
2. 最困惑的一个问题（非强制）
3. 分享自己的学习心得（非强制）

### 日常话题（作为专栏学习的讨论）：
1. 总结本专栏的有价值的问题？
2. 哪些问题可以作为面试题？
3. 实践过程中有哪些问题？

### 最终总结：
1. 参加第一期读书会的所思、所想总结
2. 对TalkGo读书会想说的话

## 第0阶段课程
《[ 开篇词 | 别再让Linux性能问题成为你的绊脚石](https://time.geekbang.org/column/article/68728)》学习笔记


很惊喜，能在我快毕业还未入职的时间阶段触及到Linux性能学习小组。
开篇词中作者提到刚参加工作那会就碰到“事故”并就此一直关注linux性能问题，
对于我而言，这件事情可能还要早一些，我在公司实习阶段就遇到我们组发生了一个多年不遇的P0事故，当然我并不是直接参与者，事故的导火索是由于上线了问题代码，
导致服务器出现雪崩效应。因为对linux底层了解不深，并没有意识到问题的严重性，直到后来跟随组内同事一起参加事故复盘讨论，我才渐渐明白事情的严重性和底层性能的重要性。
恢复服务、保留现场、定位问题，这些在线上事故发生时尤其重要。**知道事情的重要性之后，就应该尽力去想如何做到这件事**。

读了一段时间《[Linux/UNIX系统编程手册](https://book.douban.com/subject/25809330/)》，
对linux操作系统，内核接口，进程内存模型，进线程调度有了更多的理解，很多原理性的东西可以在这本书上找到答案，
但在性能实战上依然缺乏一些训练和指导，学习小组或许能帮助我填补这部分的知识空缺，这也是我为什么有些惊喜的原因。

学习从来都不是什么难事，最难的部分在于如果长期得不到想要的学习回报，我是否还能长期坚持做下去。
在这里，我提前给自己打一个预防针，做这件事情，一旦开始，就做好长期坚持的准备。

>善始善终才是生活的强者。

《[01 | 如何学习Linux性能优化？](https://time.geekbang.org/column/article/69346)》

**一般的解决问题过程**：遇见问题上网查,用别人的方法多试几次就解决了。

**劣势**：相同的错误重复再犯，相同的状况重复出现。

**更好的方法***：首先理解应用程序和系统的少数几个基本原理，实战，建立起性能全局观，然后掌握一些必要的性能工具。

![linux性能工具](../talkgo/asserts/linux_perf_tools_full.png)
[图片来源](http://www.brendangregg.com/Perf/linux_perf_tools_full.png**

## 第1阶段（CPU性能）

《[02 | 基础篇：到底应该怎么理解“平均负载”？](https://time.geekbang.org/column/article/69618)》

### 基本概念
1. **平均负载**(uptime工具结果**):单位时间内,可运行或不可中断状态的进程平均数.
与CPU使用率之间的关系,平均负载既包含了正在使用CPU的进程(这部分计算CPU使用率**,
还包括等待CPU进程和等待IO的进程.因此大量等待CPU调度进程和大量等待IO进程会导致
CPU使用率不高而平均负载特别高.

### 问题
1. 进程状态都有哪些?其中哪部分属于平均负载的计算范畴.

### 实战案例

预先安装 stress 和 sysstat 包，如 apt install stress sysstat。

实时查看负载均衡
```
➜  ~ watch -d uptime
 16:33:07 up 57 min,  1 user,  load average: 0.89, 0.64, 0.69
```

实时查看CPU性能
```
mpstat -P ALL 5
```
实时查看进程性能
```
pidstat -u 5 1
```

**场景一:CPU密集型进程**
```
stress --cpu 1 --timeout 600
```
**场景二:I/O密集型进程**
```
stress -i 1 --timeout 600
```
**场景三:大量进程的场景**
```
stress -c 8 --timeout 600
```

### 工具使用
**stress**:系统压测工具,模拟不同系统场景

**mpstat**:多核CPU性能分析工具,查看实时的或平均的CPU性能指标.(面向CPU)

**pidstat**:实时查看进程的CPU,内存,I/O及上下文切换等性能指标.(面向进程)

完。

